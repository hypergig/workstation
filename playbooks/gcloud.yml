# -*- ansible -*-
---
- name: gcloud apt key
  apt_key:
    url: https://packages.cloud.google.com/apt/doc/apt-key.gpg
    keyring: /usr/share/keyrings/cloud.google.gpg
  become: true

- name: add gcloud apt repo
  apt_repository:
    repo: "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main"
  become: true

- name: install gcloud apts
  apt:
    name:
    - google-cloud-sdk
    - kubectl
  become: true

- name: kubernetes pip package
  pip:
    name: kubernetes

- name: download istio bins
  get_url:
    url: https://github.com/istio/istio/releases/download/1.4.3/istio-1.4.3-linux.tar.gz
    dest: cache/istio-1.4.3-linux.tar.gz
    checksum: sha256:781e2c4391ba344d86fb6a4c321b76af31543e7479ea689dd7c7395fb1a41ff0

- name: istioctl bin
  unarchive:
    dest: /usr/local/bin
    extra_opts:
    - --strip-components=2
    - istio-1.4.3/bin/istioctl
    remote_src: yes
    src: "{{playbook_dir}}/cache/istio-1.4.3-linux.tar.gz"
  become: true
